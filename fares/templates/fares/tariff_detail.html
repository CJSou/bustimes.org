{% extends 'page.html' %}

{% block bodyclass %}{% endblock %}

{% block content %}

    <h1>{{ object }}</h1>

    <p>{{ object.filename }}</p>

    <p>{{ object.code }}</p>

    {% for service in object.services.all %}
        <p><a href="{{ service.get_absolute_url }}/fares">{{ service }}</a></p>
    {% endfor %}

    {% if form.fields.origin.choices %}
        <form autocomplete="off">
            {{ form.as_p }}

            <input type="submit" value="Find fare">
        </form>

        {% for result in results %}
            {% ifchanged result.start_zone %}<h3>{{ result.start_zone }} to {{ result.end_zone }}</h3>{% endifchanged %}
            <p>{{ result.html }}</p>
        {% endfor %}
    {% endif %}

    {% for price in object.price_set.all %}

        <p>{{ price.sales_offer_package }}:<br>{{ price.time_interval.name }} ({{ price.time_interval }}):<br>£{{ price.amount }}</p>

    {% endfor %}

    {% for zone in object.access_zones.all %}
        <p>{{ zone }}</p>
        <p>{{ zone.stops.all }}</p>
    {% endfor %}

    {% for table in object.faretable_set.all %}

        {% ifchanged table.name %}<h2>{{ table }}</h2>{% endifchanged %}

        <p>{% if table.preassigned_fare_product %}
            {{ table.preassigned_fare_product.name }}
        {% elif table.user_profile %}
            {{ table.user_profile|capfirst }} {{ table.sales_offer_package|lower }}
        {% elif table.sales_offer_package %}
            {{ table.sales_offer_package }}
        {% endif %}</p>

        <table class="compact nowrap">
            <tbody>
                {% if not table.is_triangular %}
                <tr class="head">
                    <th></th>
                    {% for column in table.columns %}
                        <th scope="col">{{ column }}</th>
                    {% endfor %}
                </tr>
                {% else %}
                <tr>
                    <th colspan="{{ table.columns|length|add:1 }}">{{ table.columns.0 }}</th>
                </tr>
                {% endif %}
                {% for row in table.rows %}
                    <tr>
                        {% if not table.is_triangular %}<th>{{ row }}</th>{% endif %}
                        {% for cell in row.cells %}
                            <td>{% if cell %}£{{ cell.price.amount }}{% endif %}</td>
                        {% empty %}
                            {% if forloop.counter %}
                                <td colspan="{{ forloop.counter }}"></td>
                            {% endif %}
                        {% endfor %}
                        {% if table.is_triangular %}<th colspan="{{ row.colspan }}">{{ row }}</th>{% endif %}
                    </tr>
                {% endfor %}
        </table>

    {% endfor %}

    {{ object.source.credit }}

{% endblock %}

{% block ad %}{% endblock %}
