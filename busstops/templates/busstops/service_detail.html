{% extends 'page.html' %}

{% load urlise %}

{% block title %}{{ object }} ‚Äì {% if operators %}{{ operators|join:', ' }} ‚Äì {% endif %}bustimes.org{% endblock %}

{% load static %}

{% block head %}
    <meta property="og:title" content="{{ object }}">
    <meta property="og:description" content="{{ operators|join:', ' }}">
    <link rel="stylesheet" href="{% static 'dist/js/app.css' %}">
{% endblock %}

{% block bodyclass %}{% endblock %}

{% block content %}

<h1>{{ object }}</h1>

<p>
    {% if operators %}
        {% if object.mode %}
            {{ object.get_a_mode }} service operated by
        {% else %}
            Operated by
        {% endif %}
        {% for operator in operators %}{% if not forloop.first %}{% if forloop.last %} and {% else %}, {% endif %}{% endif %}<a href="{{ operator.get_absolute_url }}">{{ operator }}</a>{% endfor %}
    {% endif %}
</p>

{% if object.public_use is False %}
    <p>üßë‚Äçüéì This may be a "closed-door" school or works service, not open to the public</p>
{% endif %}

<div class="ad-wrapper">
    <div id="AFM_inContentTop_ad"></div>
</div>

{% if object.geometry %}
    <ul class="tabs">
        <li>Timetable</li>
        <li id="map"><a href="#map">Map</a></li>
    </ul>
{% endif %}

{% include 'situations.html' %}

<div id="timetable">
    {% include 'timetable.html' %}
</div>

{% if registrations or vehicles %}
    <ul class="horizontal">
        {% for registration in registrations %}
            <li><a href="{{ registration.get_absolute_url }}">{{ registration.registration_number }}</a>
        {% endfor %}
        {% if vehicles %}
            <li><a href="{{ object.get_absolute_url }}/vehicles">Vehicles</a>
        {% endif %}
    </ul>
{% endif %}

{% if fare_tables %}
    <h2 id="fares">Fare tables</h2>

    <p>
        <select id="fare-tables">
            <option></option>
            {% for table in fare_tables %}
                <option  value="{{ table.id }}">{{ table.tariff }}</option>
            {% endfor %}
        </select>
        <noscript><input type="submit"></noscript>
    </p>

    <div id="fare-table"></div>
{% endif %}

{% if related %}
    <h2>Possibly similar services</h2>
    {% include 'service_list.html' with services=related class="has-smalls" %}
{% endif %}

{% if links %}
    <h2>More information</h2>
    <ul>
    {% for link in links %}
       <li><a href="{{ link.url }}"{% if 'traveline' in link.url %} rel="nofollow"{% endif %}>{{ link.text }}</a></li>
    {% endfor %}
    </ul>
{% endif %}

{% for operator in operators %}
    {% include 'operator-contact-details.html' %}
{% endfor %}

{% if object.public_use is not False and payment_methods %}
    <p>
        {% for method in payment_methods %}
            {% if not forloop.first %}{% if forloop.last %} or {% else %}, {% endif %}{% endif %}{% if method.url %}<a href="{{ method.url }}">{% endif %}
            {% if forloop.first %}{{ method.name.capitalize }}{% else %}{{ method }}{% endif %}{% if method.url %}</a>{% endif %}
        {% endfor %} accepted
    </p>
{% endif %}

{% if app %}
    <p>Mobile tickets and live bus tracking available on <a href="{{ app.url }}">the {{ app.name }}</a></p>
{% endif %}

{% if fare_cap %}
    <p><a href="{{ fare_cap.url }}">Get around for ¬£2</a> ‚Äì single fares are capped at ¬£2 on this service</p>
{% endif %}

{% endblock %}

{% block foot %}
    <script>
    SERVICE_ID = {{ object.id }};
    {% if object.geometry %}
        {% if object.tracking %}SERVICE_TRACKING = true;{% endif %}
        EXTENT = [{{ object.geometry.extent|join:"," }}];
            LIVERIES_CSS_URL  = "/liveries.{{ liveries_css_version }}.css";
    </script>
    <script async src="{% static 'dist/js/app.js' %}"></script>
    {% else %}</script>{% endif %}

    <script src="{% static 'js/reqwest.min.js' %}"></script>
    <script async src="{% static 'js/timetable.js' %}"></script>
    {% if fare_tables %}
        <script async src="{% static 'js/fares.js' %}"></script>
    {% endif %}
{% endblock %}
