{% extends 'page.html' %}

{% block title %}Edit details – {{ vehicle }} – bustimes.org{% endblock %}

{% block fuse %}{% endblock %}

{% block bodyclass %}narrow{% endblock %}

{% block content %}

{% if not form %}

    <h1>Thank you</h1>

    {% if revision %}
        <p>Details updated, and recorded in <a href="/vehicles/history">the changelog for all to see</a>:</p>

        <p>
            {% for key, from, to in revision.list_changes %}
                Changed {{ key }} {% if from %}from {{ from }} {% endif %}to {{ to }}
                {% if not forloop.last %}<br>{% endif %}
            {% endfor %}
        </p>
    {% endif %}

    {% if edit %}
        <p>I’ll update {% if revision %}the other{% else %}those{% endif %} details shortly</p>
    {% endif %}

{% else %}

    <h1>Edit vehicle details</h1>

    {% if vehicle.operator %}
        <p class="helptext">(Or <a href="{{ vehicle.operator.get_absolute_url }}/vehicles/edit">edit several {{ vehicle.operator }} vehicles at once</a>)</p>
    {% endif %}

    {% if pending_edits %}
        <div class="message">
            <p>❗ There’s already a pending edit for this vehicle</p>

            {% include 'vehicle_edits_table.html' with edits=pending_edits %}
        </div>
    {% endif %}

    <form action="{{ vehicle.get_edit_url }}" method="POST">
        <p>ID:<br>
        <code>{{ vehicle.id }}</code></p>

        <p>Slug:<br>
        <code>{{ vehicle.slug }}</code></p>

        <p>Ticket machine code:<br>
        <code>{{ vehicle.code }}</code></p>

        <div class="edit-vehicle">
            {{ form.as_p }}
        </div>

        <input type="submit" value="Save changes">
    </form>

{% endif %}

{% if previous %}
    <p class="previous"><a href="{{ previous.get_edit_url }}">&larr; {{ previous }}</a></p>
{% endif %}

{% if next %}
    <p class="next"><a href="{{ next.get_edit_url }}">{{ next }} &rarr;</a></p>
{% endif %}

{% endblock %}

{% block foot %}
   {% if form %}
        {% load static %}
        <script src="{% static 'js/accessible-autocomplete/accessible-autocomplete.min.js' %}"></script>
        <script async src="{% static 'js/edit-vehicle.js' %}"></script>
    {% endif %}
{% endblock %}
